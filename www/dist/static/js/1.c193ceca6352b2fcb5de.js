webpackJsonp([1],{"+XTs":function(e,t){},SHKT:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("gyMJ"),a=s("Cz8s"),r=s("TtmE"),n=s("zAgK"),l=s("w85B"),o={components:{TopHeader:a.a,KyeDialog:r.a,FilterTree:n.a,roleDetail:l.a},data:function(){return{currentKey:null,currentRoleKey:null,bindItem:{roleId:void 0,users:[],remark:void 0},currentUserName:void 0,currentRoleName:void 0,stateRole:void 0,bindStateUser:void 0,stateUser:void 0,stateUserId:void 0,pageUserId:void 0,hasDetail:!1,page:{total:0,size:10,current:1,sizes:[10,20,50,100]},tableData:[],item:{id:void 0,name:void 0,status:void 0,type:100,department_id:void 0,department_name:void 0,associated_system:[],associated_user:[]},bindDialog:{hasDialog:!1,title:"绑定角色"},treeProps:{label:"name",children:"children",isLeaf:"type"},rules:{users:{required:!0,trigger:"validate-on-rule-change",validator:function(e,t,s){t&&0!==t.length?s():s(new Error("请添加需要绑定的用户"))}},roleId:{required:!0,message:"请选择绑定的角色",trigger:"change"}}}},computed:{roleTypes:function(){return this.$store.state.roleTypes}},watch:{hasDetail:function(e){e||(this.item.name=void 0,this.item.status=void 0,this.item.type=100,this.item.department_id=void 0,this.item.department_name=void 0,this.item.associated_system=[],this.item.associated_user=[])},stateUser:function(e){void 0!==e&&""!==e||(this.stateUserId=void 0)},stateRole:function(e){void 0!==e&&""!==e||this.currentRoleKey||(this.bindItem.roleId=void 0)}},methods:{queryUser:function(e,t){i.a.getUserList({name:e,per_page:10,page:1}).then(function(e){var s=e.result||{};t(s.data||[])})},queryRoleUser:function(e,t){this.stateUserId=void 0,this.queryUser(e,t)},queryBindUser:function(e,t){this.queryUser(e,t)},queryRole:function(e,t){this.bindItem.roleId=void 0,i.a.getRoleList({name:e,per_page:10,page:1}).then(function(e){var s=e.result||{};t(s.data||[])})},handleSelectUser:function(e){this.stateUser=e.name,this.stateUserId=e.id},handleSelectRole:function(e){this.stateRole=e.name,this.bindItem.roleId=e.id,this.currentRoleKey=null,this.$refs.treeRoleRef.setCurrentKey(null)},handleSearch:function(){void 0===this.stateUserId?this.$refs.inputRef.focus():(this.pageUserId=this.stateUserId,this.currentUserName=this.stateUser,this.currentKey=null,this.$refs.treeRef.setCurrentKey(null),this.page.current=1,this.requestList())},requestList:function(){var e=this,t={user_id:this.pageUserId,page:this.page.current,per_page:this.page.size};i.a.getUserRoleList(t).then(function(t){var s=t.result||{};e.page.total=s.pagination?s.pagination.total_count:0,e.tableData=s.data||[]})},unBindRole:function(e){var t=this,s={user_id:this.pageUserId,role_id:e};this.$confirm("确定解绑该角色？点击确定后角色将自动解绑！","角色解绑",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){i.a.unBindRole(s).then(function(e){t.$message({type:"success",message:"解绑成功!"}),t.requestList()})})},handleSizeChange:function(e){this.page.size=e,this.requestList()},handleCurrentChange:function(e){this.page.current=e,this.requestList()},onOrgTreeClick:function(e,t,s){e.type?(this.currentKey=e.id,this.pageUserId=e.id,this.currentUserName=e.name,this.page.current=1,this.requestList(),this.$refs.treeRef.setCurrentKey(e.id)):this.$refs.treeRef.setCurrentKey(this.currentKey)},onRoleTreeClick:function(e,t,s){e.type?(this.currentRoleKey=e.id,this.bindItem.roleId=e.id,this.stateRole=e.name,this.currentRoleName=e.name,this.$refs.treeRoleRef.setCurrentKey(e.id)):this.$refs.treeRoleRef.setCurrentKey(this.currentRoleKey)},showBindDialog:function(e){this.bindDialog.hasDialog=e,e||this.resetForm("ruleForm")},onDetail:function(e){this.hasDetail=!0,this.getRoleInfo(e)},getRoleInfo:function(e){var t=this;i.a.getRole(e).then(function(e){var s=e.result||{};t.item.id=s.id,t.item.name=s.name,t.item.status=s.status,t.item.type=s.type,t.item.department_id=s.department_id,t.item.department_name=s.department_name,t.item.associated_system=s.associated_system,t.item.associated_user=s.associated_user,t.departmentName=s.department_name})},bindRole:function(){this.currentRoleKey=null,this.currentRoleName=void 0,this.stateRole=void 0,this.bindStateUser=void 0,this.bindItem.remark=void 0,this.bindItem.roleId=void 0,this.bindItem.users=this.$refs.treeRef.getCheckedNodes(!0),this.showBindDialog(!0)},handleSelectBindUser:function(e){this.bindStateUser=void 0,-1===this.bindItem.users.findIndex(function(t){return t.id===e.id})&&this.bindItem.users.push(e)},onRoleBlur:function(){this.currentRoleName&&(this.stateRole=this.currentRoleName)},handleDelUser:function(e){this.bindItem.users.splice(e,1)},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var s={role_id:t.bindItem.roleId,remark:t.bindItem.remark,user_ids:t.bindItem.users.map(function(e){return e.id})};i.a.bindRole(s).then(function(e){t.$message({type:"success",message:"绑定成功!"}),t.showBindDialog(!1)})})},resetForm:function(e){this.$refs[e].resetFields()},loadNode:function(e,t){i.a.getOrgTree({department_id:e.data?e.data.id:void 0}).then(function(e){var s=e.result||[];s.forEach(function(e){e.type=!e.type}),t(s)})},loadRoleNode:function(e,t){i.a.getRoleTree({department_id:e.data?e.data.id:void 0}).then(function(e){var s=e.result||[];s.forEach(function(e){e.type=!e.type}),t(s)})}}},d={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"page-box"},[s("top-header",{attrs:{title:"用户角色管理"}},[s("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){e.bindRole()}}},[s("svg",{staticClass:"icon icon-svg",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-bangding"}})]),e._v(" "),s("span",{staticClass:"icon-svg-txt"},[e._v(" 绑定角色")])])],1),e._v(" "),s("div",{staticClass:"page-container"},[s("div",{staticClass:"box-tree"},[s("strong",{staticClass:"box-title"},[e._v("组织架构")]),e._v(" "),s("div",{staticClass:"tree-wraper"},[s("div",{staticClass:"uzzy-search"},[s("el-autocomplete",{ref:"inputRef",attrs:{clearable:"","fetch-suggestions":e.queryRoleUser,placeholder:"请输入员工姓名","trigger-on-focus":!1},on:{select:e.handleSelectUser},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.item;return[s("div",{staticClass:"name text-overflow-ellipsis",attrs:{title:i.name+"，"+i.department_name}},[e._v(e._s(i.name+"，"+i.department_name))])]}}]),model:{value:e.stateUser,callback:function(t){e.stateUser=t},expression:"stateUser"}},[s("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"small"},on:{click:e.handleSearch}},[e._v("查询")])],1),e._v(" "),s("div",{staticClass:"tree-box"},[s("el-tree",{ref:"treeRef",attrs:{"highlight-current":!0,props:e.treeProps,load:e.loadNode,"node-key":"id",lazy:"","show-checkbox":""},on:{"node-click":e.onOrgTreeClick}})],1)])]),e._v(" "),s("div",{staticClass:"box-list"},[s("strong",{staticClass:"box-title"},[e._v("角色列表"),s("span",{directives:[{name:"show",rawName:"v-show",value:e.currentUserName,expression:"currentUserName"}]},[e._v(e._s("-  "+e.currentUserName))])]),e._v(" "),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,size:"mini"}},[s("el-table-column",{attrs:{type:"index",label:"序号",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s((e.page.current-1)*e.page.size+t.$index+1)+"\n          ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"name",label:"角色名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(s){e.onDetail(t.row.id)}}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"type",label:"角色类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(e.roleTypes[t.row.type])+"\n          ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"status",label:"角色状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{style:{color:"1"==t.row.status?"#00C353":"#E96767"}},[e._v("\n              "+e._s("1"==t.row.status?"已启用":"已禁用")+"\n            ")])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"created_by",label:"创建人"}}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[100===t.row.type?s("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(s){e.unBindRole(t.row.id)}}},[e._v("解绑")]):e._e()]}}])})],1),e._v(" "),s("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.page.total>e.page.sizes[0],expression:"page.total > page.sizes[0]"}],attrs:{background:"","page-sizes":e.page.sizes,layout:"sizes,prev,pager,next","current-page":e.page.current,total:e.page.total,"prev-text":"上一页","next-text":"下一页"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.$set(e.page,"current",t)}}})],1)]),e._v(" "),s("kye-dialog",{attrs:{width:"772px",hasDialog:!!e.bindDialog.hasDialog,title:e.bindDialog.title},on:{"is-show-dialog":e.showBindDialog}},[s("div",{attrs:{slot:"body"},slot:"body"},[s("el-form",{ref:"ruleForm",attrs:{model:e.bindItem,rules:e.rules}},[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{prop:"users"}},[s("strong",{staticClass:"box-title"},[e._v("已选用户")])]),e._v(" "),s("div",{staticClass:"tree-wraper bind-item"},[s("div",{staticClass:"uzzy-search"},[s("el-autocomplete",{attrs:{clearable:"","fetch-suggestions":e.queryBindUser,placeholder:"请输入员工姓名","trigger-on-focus":!1},on:{select:e.handleSelectBindUser},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.item;return[s("div",{staticClass:"name text-overflow-ellipsis",attrs:{title:i.name+"，"+i.department_name}},[e._v(e._s(i.name+"，"+i.department_name))])]}}]),model:{value:e.bindStateUser,callback:function(t){e.bindStateUser=t},expression:"bindStateUser"}},[s("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})])],1),e._v(" "),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.bindItem.users,size:"mini"}},[s("el-table-column",{attrs:{prop:"name",label:"用户名"}}),e._v(" "),s("el-table-column",{attrs:{prop:"department_name",label:"所属部门"}}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(s){e.handleDelUser(t.$index)}}},[e._v("移除")])]}}])})],1)],1),e._v(" "),s("div",{staticClass:"table-filters bind-role-filter"},[s("div",{staticClass:"filter-item"},[s("p",{staticClass:"item"},[e._v("备注内容")]),e._v(" "),s("el-input",{attrs:{type:"textarea",clearable:"",size:"mini",autosize:{minRows:1,maxRows:3},placeholder:"请输入申请内容"},model:{value:e.bindItem.remark,callback:function(t){e.$set(e.bindItem,"remark",t)},expression:"bindItem.remark"}})],1)])],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{prop:"roleId"}},[s("strong",{staticClass:"box-title"},[e._v("角色列表")])]),e._v(" "),s("div",{staticClass:"tree-wraper bind-tree-wraper"},[s("div",{staticClass:"uzzy-search"},[s("el-autocomplete",{ref:"inputRef",attrs:{clearable:"","fetch-suggestions":e.queryRole,placeholder:"请输入角色名称","trigger-on-focus":!1},on:{blur:e.onRoleBlur,select:e.handleSelectRole},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.item;return[s("div",{staticClass:"name text-overflow-ellipsis",attrs:{title:i.name+"，"+i.department_name}},[e._v(e._s(i.name+"，"+i.department_name))])]}}]),model:{value:e.stateRole,callback:function(t){e.stateRole=t},expression:"stateRole"}},[s("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})])],1),e._v(" "),s("div",{staticClass:"tree-box"},[s("el-tree",{ref:"treeRoleRef",attrs:{"highlight-current":!0,props:e.treeProps,load:e.loadRoleNode,"node-key":"id",lazy:""},on:{"node-click":e.onRoleTreeClick}})],1)])],1)],1)],1)],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"small"},on:{click:function(t){e.bindDialog.hasDialog=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("保存")])],1)]),e._v(" "),s("role-detail",{attrs:{item:e.item,"role-types":e.roleTypes,"has-detail":e.hasDetail},on:{"is-show-dialog":function(t){e.hasDetail=!1}}})],1)},staticRenderFns:[]};var c=s("vSla")(o,d,!1,function(e){s("+XTs")},"data-v-51f6d6ba",null);t.default=c.exports},Swgr:function(e,t){},w85B:function(e,t,s){"use strict";var i=s("TtmE"),a=s("45w3"),r={components:{KyeDialog:i.a,SystemItem:a.a},data:function(){return{}},props:{item:{type:Object,required:!0},hasDetail:{type:Boolean,required:!0},roleTypes:{type:Object,required:!0},title:{type:String,default:"角色详情"}},methods:{isShowDialog:function(){this.$emit("is-show-dialog",!1)}}},n={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("kye-dialog",{attrs:{hasDialog:e.hasDetail,title:e.title},on:{"is-show-dialog":e.isShowDialog}},[s("div",{attrs:{slot:"body"},slot:"body"},[s("div",{staticClass:"detail-filters"},[s("el-row",[s("el-col",{attrs:{span:8}},[s("div",[e._v("角色名称"),s("span",[e._v(e._s(e.item.name))])])]),e._v(" "),s("el-col",{attrs:{span:8}},[s("div",[e._v("角色类型"),s("span",[e._v(e._s(e.roleTypes[e.item.type]))])])]),e._v(" "),s("el-col",{attrs:{span:8}},[s("div",[e._v("角色状态"),s("span",[e._v(e._s("1"==e.item.status?"已启用":"已禁用"))])])])],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:8}},[s("div",[e._v("所属部门"),s("span",[e._v(e._s(e.item.department_name))])])])],1)],1),e._v(" "),s("div",{staticClass:"li-item"},[s("i"),s("span",{staticClass:"li-item-title"},[e._v("关联系统")])]),e._v(" "),s("div",{staticClass:"system-items"},e._l(e.item.associated_system,function(e,t){return s("system-item",{key:t,attrs:{item:e}})})),e._v(" "),s("div",{staticClass:"li-item"},[s("i"),s("span",{staticClass:"li-item-title"},[e._v("关联用户")])]),e._v(" "),s("div",{staticClass:"dialog-table"},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.item.associated_user,size:"mini"}},[s("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),e._v(" "),s("el-table-column",{attrs:{prop:"employee_code",label:"工号"}}),e._v(" "),s("el-table-column",{attrs:{prop:"name",label:"用户名"}}),e._v(" "),s("el-table-column",{attrs:{prop:"department_name",label:"所属部门"}})],1)],1)]),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.isShowDialog}},[e._v("确定")])],1)])},staticRenderFns:[]};var l=s("vSla")(r,n,!1,function(e){s("Swgr")},"data-v-67a80b84",null);t.a=l.exports}});
//# sourceMappingURL=1.c193ceca6352b2fcb5de.js.map