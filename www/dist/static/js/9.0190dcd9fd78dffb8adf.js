webpackJsonp([9],{dRL0:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=t("rVsN"),l=t.n(r),o=t("ZLEe"),i=t.n(o),s=t("3cXf"),n=t.n(s),p=t("gyMJ"),u=t("Cz8s"),c=t("TtmE"),d={components:{TopHeader:u.a,KyeDialog:c.a},data:function(){return{kyeDialog:{hasDialog:!1,title:"新增流程配置"},filterCondition:{associated_system_id:"",page:1,per_page:10},handleType:"",approvalData:[],page:{total:0,size:10,current:1,sizes:[10,20,50,100]},selectSys:[],defaultRuleForm:"",onEditEmpty:"",ruleForm:{id:0,associated_system_id:"",remark:"",approval_flow:[{level:1,approval_type:void 0,approval_user_name:"",approval_user_id:void 0,approval_role_id:void 0,approval_role_name:""}]},rules:{associated_system_id:[{required:!0,message:"请选择系统名称",trigger:"blur"}],approval_flow:[{approval_type:[{required:!0,message:"请选择一级审批",trigger:"blur"}],approval_user_name:[{required:!0,message:"请输入审批人",trigger:"change"}],approval_role_name:[{required:!0,message:"请输入审批人",trigger:"change"}]},{approval_type:[{required:!0,message:"请选择二级审批",trigger:"blur"}],approval_user_name:[{required:!0,message:"请输入审批人",trigger:"change"}],approval_role_name:[{required:!0,message:"请输入审批人",trigger:"change"}]},{approval_type:[{required:!0,message:"请选择三级审批",trigger:"blur"}],approval_user_name:[{required:!0,message:"请输入审批人",trigger:"change"}],approval_role_name:[{required:!0,message:"请输入审批人",trigger:"change"}]},{approval_type:[{required:!0,message:"请选择四级审批",trigger:"blur"}],approval_user_name:[{required:!0,message:"请输入审批人",trigger:"change"}],approval_role_name:[{required:!0,message:"请输入审批人",trigger:"change"}]},{approval_type:[{required:!0,message:"请选择五级审批",trigger:"blur"}],approval_user_name:[{required:!0,message:"请输入审批人",trigger:"change"}],approval_role_name:[{required:!0,message:"请输入审批人",trigger:"change"}]}]},restaurants:{users:[],roles:[]},state4:"",timeout:null}},created:function(){var e=this;this.defaultRuleForm=JSON.parse(n()(this.ruleForm)),this.getSearchData(),p.a.getConfigurationApprovalSys().then(function(a){200===a.code&&(e.selectSys=a.result)})},computed:{cptPagination:function(){return this.page.total>=10}},methods:{onAdd:function(){this.handleType="ADD",this.ruleForm=JSON.parse(n()(this.defaultRuleForm)),this.onReset("ruleForm"),this.kyeDialog.title="新增审批流程",this.isShowDialog(!0)},isShowDialog:function(e){this.kyeDialog.hasDialog=e},getSearchData:function(){var e=this;p.a.getConfigurationApprovalList(this.filterCondition).then(function(a){200===a.code&&(e.approvalData=a.result.data,e.page.total=a.result.pagination.total_count)})},handleSizeChange:function(e){e&&(this.filterCondition.per_page=e),this.page.current=this.filterCondition.page=1,this.getSearchData()},handleCurrentPageChange:function(e){this.filterCondition.page=e,this.getSearchData()},submitForm:function(e){var a=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;switch(a.handleType){case"ADD":a.addConfig(a.ruleForm);break;case"EDIT":a.editConfig(a.ruleForm);break;default:console.log(a.handleType,"=====")}})},onAddStep:function(e){if(!(this.ruleForm.approval_flow.length>=5||this.ruleForm.approval_flow.length>e+1)){var a=e+2;this.ruleForm.approval_flow.push({level:a,approval_type:void 0,approval_user_name:"",approval_user_id:void 0,approval_role_id:void 0,approval_role_name:""})}},onDelStep:function(e){this.ruleForm.approval_flow.splice(e,1)},onEdit:function(e){var a=this;this.handleType="EDIT",p.a.getConfigurationApprovalId({id:e.id}).then(function(e){200===e.code&&(a.ruleForm=e.result,a.kyeDialog.title="修改审批流程",a.isShowDialog(!0))})},onReset:function(e){if(!this.$refs[e])return!1;this.$refs[e].resetFields()},filterKey:function(e,a){var t=this;return e.map(function(e){return t.$utils.checkStep(e[[a]])})},querySearchAsyncUser:function(e,a){var t=this;p.a.getUserList().then(function(r){var l=r.result.data,o=e?l.filter(t.createStateFilter(e)):l;a(o)})},querySearchAsyncRole:function(e,a){var t=this,r=i()(this.$store.state.roleTypes)[5];p.a.getRoleList({type:r}).then(function(r){var l=r.result.data,o=e?l.filter(t.createStateFilter(e)):l;a(o)})},createStateFilter:function(e){return function(a){return 0===a.name.toLowerCase().indexOf(e.toLowerCase())}},handleSelect:function(e,a,t){3===t?this.ruleForm.approval_flow[a].approval_role_id=e.id:this.ruleForm.approval_flow[a].approval_user_id=e.id},handleChange:function(e,a){},onDelete:function(e){var a=this;return p.a.delConfigurationApprovalId(e).then(function(e){return 200===e.code?(a.getSearchData(),l.a.resolve(!0)):l.a.resolve(!1)})},addConfig:function(e){var a=this;p.a.postConfigurationApproval(e).then(function(e){200===e.code&&(a.getSearchData(),a.isShowDialog(!1),a.$message({message:"操作成功",type:"success"}))})},editConfig:function(e){var a=this;console.log("========",e),p.a.putConfigurationApprovalId(e.id,e).then(function(e){200===e.code&&(a.getSearchData(),a.isShowDialog(!1),a.$message({message:"操作成功",type:"success"}))})}}},v={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"page-box"},[t("top-header",{attrs:{title:"审批流程配置"}},[t("div",{staticClass:"el-icon-plus",on:{click:e.onAdd}},[e._v("新增")])]),e._v(" "),t("div",{staticClass:"page-container"},[t("div",{staticClass:"table-filters"},[t("div",{staticClass:"filter-item"},[t("p",{staticClass:"item"},[e._v("所属系统")]),e._v(" "),t("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:e.filterCondition.associated_system_id,callback:function(a){e.$set(e.filterCondition,"associated_system_id",a)},expression:"filterCondition.associated_system_id"}},e._l([{name:"不限",id:""}].concat(e.selectSys),function(e,a){return t("el-option",{key:a,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),t("div",{staticClass:"search-btn"},[t("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search"},on:{click:function(a){e.handleSizeChange()}}},[e._v("查询")])],1)]),e._v(" "),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.approvalData,size:"mini"}},[t("el-table-column",{attrs:{label:"序号",width:"60"},scopedSlots:e._u([{key:"default",fn:function(a){return[e._v("\n          "+e._s((e.page.current-1)*e.page.size+a.$index+1)+"\n        ")]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"associated_system_name",label:"所属系统"}}),e._v(" "),t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"审批流程"},scopedSlots:e._u([{key:"default",fn:function(a){return[e._v("\n          "+e._s(e.$utils.joinName(e.filterKey(a.row.approval_flow,"approval_type")," > "))+"\n        ")]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"remark",label:"备注"}}),e._v(" "),t("el-table-column",{attrs:{fixed:"right",label:"操作",width:"90"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.onEdit(a.row)}}},[e._v("修改")]),e._v(" "),t("el-button",{attrs:{size:"mini",type:"text"}},[t("kye-confirm",{attrs:{label:"删除",title:"删除审批流程配置",content:"确定要删除"+a.row.associated_system_name+"系统审批流程配置？",callback:e.onDelete,"scope-data":a.row}})],1)]}}])})],1),e._v(" "),t("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.cptPagination,expression:"cptPagination"}],attrs:{background:"","page-sizes":e.page.sizes,layout:"sizes,prev,pager,next","current-page":e.page.current,total:e.page.total,"prev-text":"上一页","next-text":"下一页"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentPageChange,"update:currentPage":function(a){e.$set(e.page,"current",a)}}})],1),e._v(" "),t("kye-dialog",{attrs:{hasDialog:e.kyeDialog.hasDialog,title:e.kyeDialog.title},on:{"is-show-dialog":e.isShowDialog,reset:function(a){e.onReset("ruleForm")}}},[t("div",{attrs:{slot:"body"},slot:"body"},[t("el-form",{ref:"ruleForm",attrs:{inline:!0,model:e.ruleForm,rules:e.rules}},[t("div",{staticClass:"dialog-tabel-item"},[t("el-form-item",{attrs:{prop:"associated_system_id"}},[t("p",[e._v("所属系统")]),e._v(" "),t("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:e.ruleForm.associated_system_id,callback:function(a){e.$set(e.ruleForm,"associated_system_id",a)},expression:"ruleForm.associated_system_id"}},e._l(e.selectSys,function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})}))],1),e._v(" "),t("el-form-item",{attrs:{prop:"remark"}},[t("p",[e._v("备注")]),e._v(" "),t("el-input",{attrs:{clearable:"",size:"small",placeholder:"请输入备注"},model:{value:e.ruleForm.remark,callback:function(a){e.$set(e.ruleForm,"remark",a)},expression:"ruleForm.remark"}})],1)],1),e._v(" "),t("div",{staticClass:"li-item"},[t("i"),t("span",{staticClass:"li-item-title"},[e._v("审批节点配置")])]),e._v(" "),e._l(e.ruleForm.approval_flow,function(a,r){return t("div",{key:r,staticClass:"dialog-tabel-item"},[t("p",[e._v(e._s(e.$utils.checkLevel(r+1)))]),e._v(" "),t("el-form-item",{attrs:{prop:"approval_flow["+r+"].approval_type"}},[t("el-select",{attrs:{size:"small",placeholder:"请选择"},on:{change:function(a){e.handleChange(a,r)}},model:{value:e.ruleForm.approval_flow[r].approval_type,callback:function(a){e.$set(e.ruleForm.approval_flow[r],"approval_type",a)},expression:"ruleForm.approval_flow[index].approval_type"}},e._l(e.$utils.checkStep(),function(e,a){return t("el-option",{key:a,attrs:{value:parseInt(a),label:e}})}))],1),e._v(" "),3===e.ruleForm.approval_flow[r].approval_type?t("el-form-item",{attrs:{prop:"approval_flow["+r+"].approval_role_name"}},[t("el-autocomplete",{attrs:{"value-key":"name",size:"small",clearable:"","fetch-suggestions":e.querySearchAsyncRole,placeholder:"请输入内容"},on:{select:function(a){e.handleSelect(a,r,3)}},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.item;return[t("div",{staticClass:"name text-overflow-ellipsis"},[e._v(e._s(r.name))])]}}]),model:{value:e.ruleForm.approval_flow[r].approval_role_name,callback:function(a){e.$set(e.ruleForm.approval_flow[r],"approval_role_name",a)},expression:"ruleForm.approval_flow[index].approval_role_name"}})],1):e._e(),e._v(" "),4===e.ruleForm.approval_flow[r].approval_type?t("el-form-item",{attrs:{prop:"approval_flow["+r+"].approval_user_name"}},[t("el-autocomplete",{attrs:{"value-key":"name",size:"small",clearable:"","fetch-suggestions":e.querySearchAsyncUser,placeholder:"请输入内容"},on:{select:function(a){e.handleSelect(a,r,4)}},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.item;return[t("div",{staticClass:"name text-overflow-ellipsis"},[e._v(e._s(r.name))])]}}]),model:{value:e.ruleForm.approval_flow[r].approval_user_name,callback:function(a){e.$set(e.ruleForm.approval_flow[r],"approval_user_name",a)},expression:"ruleForm.approval_flow[index].approval_user_name"}})],1):e._e(),e._v(" "),t("el-form-item",[t("div",{staticStyle:{"padding-top":"1px","margin-left":"10px"}},[t("div",{staticClass:"table-btn el-icon-plus",on:{click:function(a){e.onAddStep(r)}}},[e._v(" 新增")]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:0!==r,expression:"index !== 0"}],staticClass:"table-btn el-icon-delete",on:{click:function(a){e.onDelStep(r)}}},[e._v(" 删除")])])])],1)})],2)],1),e._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small"},on:{click:function(a){e.kyeDialog.hasDialog=!1}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){e.submitForm("ruleForm")}}},[e._v("保存")])],1)])],1)},staticRenderFns:[]};var _=t("vSla")(d,v,!1,function(e){t("vFfe")},"data-v-6d4cc6cc",null);a.default=_.exports},vFfe:function(e,a){}});
//# sourceMappingURL=9.0190dcd9fd78dffb8adf.js.map