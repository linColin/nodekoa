webpackJsonp([4],{Swgr:function(e,t){},eOib:function(e,t){},rCvC:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("4YfN"),a=i.n(s),n=i("gyMJ"),l=i("Cz8s"),o=i("TtmE"),r=i("45w3"),d=i("w85B"),m={components:{TopHeader:l.a,KyeDialog:o.a,SystemItem:r.a,roleDetail:d.a},data:function(){return{filterText:"",defaultProps:{children:"children",label:"name"},orgs:[],stateSystem:void 0,stateUser:void 0,kyeDialog:{hasDialog:!1,title:"新增职能角色"},hasDetail:!1,isShowFilterTree:!1,departmentName:void 0,page:{total:0,size:10,current:1,sizes:[10,20,50,100]},filterCondition:{name:void 0,department_name:void 0,status:void 0},roleStatus:[{id:1,name:"已启用"},{id:2,name:"已禁用"}],tableData:[],item:{id:void 0,name:void 0,status:void 0,type:100,department_id:void 0,department_name:void 0,associated_system:[],associated_user:[]},rules:{name:{required:!0,message:"请输入角色名称",trigger:"change"},status:{required:!0,message:"请选择角色状态",trigger:"change"},department_id:{required:!0,message:"请选择所属部门",trigger:"change"}},w:0,x:0,y:0}},computed:{userInfo:function(){return this.$store.state.userInfo},roleTypes:function(){return this.$store.state.roleTypes},isAuthoritySystemRole:function(){return-1!==(this.userInfo.role||[]).findIndex(function(e){return 1===e.type})},isEdit:function(){return"edit"===this.kyeDialog.hasDialog}},watch:{filterText:function(e){this.$refs.tree.filter(e)},hasDetail:function(e,t){e||(this.item.name=void 0,this.item.status=void 0,this.item.type=100,this.item.department_id=void 0,this.item.department_name=void 0,this.item.associated_system=[],this.item.associated_user=[])}},methods:{filterNode:function(e,t){return!e||e===this.departmentName||-1!==t.name.indexOf(e)},isBuiltInRole:function(e){return-1!==[1,2,3,4,5].indexOf(e)},isSectionRole:function(e){return 200===e},handleSearch:function(){this.page.current=1,this.requestList()},requestList:function(){var e=this,t=a()({},this.filterCondition,{page:this.page.current,per_page:this.page.size});n.a.getRoleList(t).then(function(t){var i=t.result||{};e.page.total=i.pagination?i.pagination.total_count:0,e.tableData=i.data||[]})},requestDepartmentTree:function(){var e=this;n.a.getDepartmentTree().then(function(t){e.orgs=t.result||[]})},onAdd:function(){this.resetForm("ruleForm"),this.kyeDialog.title="新增职能角色",this.isShowDialog("add")},onDetail:function(e){this.hasDetail=!0,this.getRoleInfo(e)},onEdit:function(e){this.kyeDialog.title="修改角色",this.isShowDialog("edit"),this.getRoleInfo(e)},getRoleInfo:function(e){var t=this;n.a.getRole(e).then(function(e){var i=e.result||{};t.item.id=i.id||void 0,t.item.name=i.name||void 0,t.item.status=i.status||void 0,t.item.type=i.type||void 0,t.item.department_id=i.department_id||void 0,t.item.department_name=i.department_name||void 0,t.item.associated_system=i.associated_system||[],t.item.associated_user=i.associated_user||[],t.departmentName=i.department_name,t.filterText=i.department_name})},isShowDialog:function(e){this.kyeDialog.hasDialog=e,e?this.orgs&&0!==this.orgs.length||this.requestDepartmentTree():(this.filterText=void 0,this.stateUser=void 0,this.stateSystem=void 0,this.departmentName=void 0,this.item.id=void 0,this.item.name=void 0,this.item.status=void 0,this.item.type=100,this.item.department_id=void 0,this.item.department_name=void 0,this.item.associated_system=[],this.item.associated_user=[],this.resetForm("ruleForm"))},showDepartmentList:function(){if(this.isEdit)return!1;if(!this.isShowFilterTree){var e=this.$refs.treeParent.getBoundingClientRect(),t=e.x,i=e.y,s=e.height,a=e.width;this.x=t,this.w=a,this.y=i+s}this.isShowFilterTree=!0},onDepartmentBlur:function(){this.departmentName&&(this.filterText=this.departmentName)},handleNodeClick:function(e){this.item.department_id!==e.id&&(this.item.associated_user=[],this.stateUser=void 0),this.departmentName=e.name,this.item.department_id=e.id,this.filterText=e.name,this.isShowFilterTree=!1},handleSizeChange:function(e){this.page.size=e,this.requestList()},handleCurrentChange:function(e){this.page.current=e,this.requestList()},handleDelRole:function(e){var t=this;this.$confirm("删除角色后将不可恢复，确定删除角色?","删除角色",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){n.a.delRole(e).then(function(e){t.$message({type:"success",message:"删除成功!"}),t.requestList()})})},handleDelUser:function(e){this.item.associated_user.splice(e,1)},handleDelSystem:function(e){this.item.associated_system.splice(e,1)},querySystem:function(e,t){n.a.searchSys({name:e,per_page:10,page:1}).then(function(e){var i=e.result||{};t(i.data||[])})},queryUser:function(e,t){n.a.getUserList({name:e,department_id:this.item.department_id,per_page:10,page:1}).then(function(e){var i=e.result||{};t(i.data||[])})},handleSelectSystem:function(e){this.stateSystem=void 0,-1===this.item.associated_system.findIndex(function(t){return t.id===e.id})&&this.item.associated_system.push(e)},handleSelectUser:function(e){this.stateUser=void 0,-1===this.item.associated_user.findIndex(function(t){return t.id===e.id})&&this.item.associated_user.push(e)},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var i={name:t.item.name,status:t.item.status,type:t.item.type,department_id:t.item.department_id,associated_system:t.item.associated_system.map(function(e){return{id:e.id,name:e.name}}),associated_user:t.item.associated_user.map(function(e){return{id:e.id,name:e.name}})};t.isEdit?n.a.putRole(t.item.id,i).then(function(e){t.$message({type:"success",message:"修改成功!"}),t.isShowDialog(),t.requestList()}):n.a.addRole(i).then(function(e){t.$message({type:"success",message:"新增成功!"}),t.isShowDialog(),t.requestList()})})},resetForm:function(e){this.$refs[e]&&this.$refs[e].resetFields&&this.$refs[e].resetFields()},onBodyClick:function(e){this.isShowFilterTree=!1}},beforeMount:function(){this.requestList()}},c={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"page-box",on:{click:e.onBodyClick}},[i("top-header",{attrs:{title:"角色管理"}},[i("el-button",{staticClass:"el-icon-plus",attrs:{type:"text",size:"mini"},on:{click:e.onAdd}},[e._v(" 新增职能角色")])],1),e._v(" "),i("div",{staticClass:"page-container"},[i("div",{staticClass:"table-filters"},[i("div",{staticClass:"filter-item"},[i("p",{staticClass:"item"},[e._v("角色名称")]),e._v(" "),i("el-input",{attrs:{clearable:"",size:"small",placeholder:"请输入"},model:{value:e.filterCondition.name,callback:function(t){e.$set(e.filterCondition,"name",t)},expression:"filterCondition.name"}})],1),e._v(" "),i("div",{staticClass:"filter-item"},[i("p",{staticClass:"item"},[e._v("所属部门")]),e._v(" "),i("el-input",{attrs:{clearable:"",size:"small",placeholder:"请输入"},model:{value:e.filterCondition.department_name,callback:function(t){e.$set(e.filterCondition,"department_name",t)},expression:"filterCondition.department_name"}})],1),e._v(" "),i("div",{staticClass:"filter-item"},[i("p",{staticClass:"item"},[e._v("角色状态")]),e._v(" "),i("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:e.filterCondition.status,callback:function(t){e.$set(e.filterCondition,"status",t)},expression:"filterCondition.status"}},[i("el-option",{attrs:{label:"不限",value:void 0}}),e._v(" "),e._l(e.roleStatus,function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})],2)],1),e._v(" "),i("div",{staticClass:"search-btn"},[i("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("查询\n        ")])],1)]),e._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,size:"mini"}},[i("el-table-column",{attrs:{type:"index",label:"序号",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s((e.page.current-1)*e.page.size+t.$index+1)+"\n        ")]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"name",label:"角色名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(i){e.onDetail(t.row.id)}}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"type",label:"角色类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e.roleTypes[t.row.type])+"\n        ")]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"status",label:"角色状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{style:{color:"1"==t.row.status?"#00C353":"#E96767"}},[e._v("\n            "+e._s("1"==t.row.status?"已启用":"已禁用")+"\n          ")])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"department_name",label:"所属部门"}}),e._v(" "),i("el-table-column",{attrs:{prop:"created_by",label:"创建人"}}),e._v(" "),i("el-table-column",{attrs:{prop:"updated_by",label:"角色修改人"}}),e._v(" "),i("el-table-column",{attrs:{prop:"updated_at",label:"角色修改时间",width:"125"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("datetime")(t.row.updated_at))+"\n        ")]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isAuthoritySystemRole||!e.isBuiltInRole(t.row.type)?i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(i){e.onEdit(t.row.id)}}},[e._v("修改")]):e._e(),e._v(" "),e.isAuthoritySystemRole&&100===t.row.type?i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(i){e.handleDelRole(t.row.id)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),i("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.page.total>e.page.sizes[0],expression:"page.total > page.sizes[0]"}],attrs:{background:"","page-sizes":e.page.sizes,layout:"sizes,prev,pager,next","current-page":e.page.current,total:e.page.total,"prev-text":"上一页","next-text":"下一页"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.$set(e.page,"current",t)}}})],1),e._v(" "),i("kye-dialog",{attrs:{"has-dialog":!!e.kyeDialog.hasDialog,title:e.kyeDialog.title},on:{"is-show-dialog":e.isShowDialog}},[i("div",{attrs:{slot:"body"},slot:"body"},[i("el-form",{ref:"ruleForm",attrs:{model:e.item,rules:e.rules,"label-position":"top"}},[i("div",{staticClass:"table-filters"},[i("div",{staticClass:"filter-item"},[i("p",{staticClass:"item label-required"},[e._v("角色名称")]),e._v(" "),i("el-form-item",{attrs:{prop:"name"}},[i("el-input",{attrs:{clearable:"",size:"small",placeholder:"请输入"},model:{value:e.item.name,callback:function(t){e.$set(e.item,"name",t)},expression:"item.name"}})],1)],1),e._v(" "),i("div",{staticClass:"filter-item"},[i("p",{staticClass:"item label-required"},[e._v("角色状态")]),e._v(" "),i("el-form-item",{attrs:{prop:"status"}},[i("el-select",{attrs:{disabled:e.isEdit&&e.isBuiltInRole(e.item.type),size:"small",placeholder:"请选择"},model:{value:e.item.status,callback:function(t){e.$set(e.item,"status",t)},expression:"item.status"}},e._l(e.roleStatus,function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})}))],1)],1),e._v(" "),e.isBuiltInRole(e.item.type)?e._e():i("div",{staticClass:"filter-item",staticStyle:{width:"410px"}},[i("p",{staticClass:"item label-required"},[e._v("所属部门")]),e._v(" "),i("el-form-item",{attrs:{prop:"department_id"}},[i("div",{staticStyle:{position:"relative",width:"100%"}},[i("div",{ref:"treeParent",staticClass:"filter-input-box",on:{click:function(e){return e.stopPropagation(),!1}}},[i("el-input",{staticStyle:{display:"none"},attrs:{type:"hidden"},model:{value:e.item.department_id,callback:function(t){e.$set(e.item,"department_id",t)},expression:"item.department_id"}}),e._v(" "),i("el-input",{ref:"filterInput",attrs:{placeholder:"输入关键字进行过滤",size:"small",clearable:!e.isEdit,readonly:e.isEdit,"suffix-icon":e.isEdit?null:"el-icon-search"},on:{focus:e.showDepartmentList,blur:e.onDepartmentBlur},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isEdit&&e.isShowFilterTree,expression:"!isEdit && isShowFilterTree"}],staticClass:"filter-tree-w filter-tree-wrap el-select-dropdown el-popper",style:{top:e.y+"px",left:e.x+"px",width:e.w+"px"}},[i("el-tree",{directives:[{name:"show",rawName:"v-show",value:e.orgs&&e.orgs.length>0,expression:"orgs && orgs.length > 0"}],ref:"tree",attrs:{"node-key":"id",data:e.orgs,"expand-on-click-node":!0,props:e.defaultProps,"filter-node-method":e.filterNode,"highlight-current":!0},on:{"node-click":e.handleNodeClick}})],1)])])],1)]),e._v(" "),e.isEdit&&e.isBuiltInRole(e.item.type)?e._e():i("div",{staticClass:"li-item"},[i("i"),i("span",{staticClass:"li-item-title"},[e._v("关联系统")]),e._v(" "),i("el-autocomplete",{attrs:{"fetch-suggestions":e.querySystem,placeholder:"输入选择即可添加关联系统","trigger-on-focus":!1},on:{select:e.handleSelectSystem},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.item;return[i("div",{staticClass:"name text-overflow-ellipsis"},[e._v(e._s(s.name))])]}}]),model:{value:e.stateSystem,callback:function(t){e.stateSystem=t},expression:"stateSystem"}})],1),e._v(" "),e.isEdit&&e.isBuiltInRole(e.item.type)?e._e():i("div",{staticClass:"system-items"},e._l(e.item.associated_system,function(t,s){return i("system-item",{key:t.id,attrs:{showClose:!e.isEdit||!e.isBuiltInRole(e.item.type),item:t},on:{"del-click":function(t){e.handleDelSystem(s)}}})})),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!!this.item.department_id||e.isBuiltInRole(e.item.type),expression:"!!this.item.department_id || isBuiltInRole(item.type)"}],staticClass:"li-item"},[i("i"),i("span",{staticClass:"li-item-title"},[e._v("关联用户")]),e._v(" "),e.isEdit&&e.isSectionRole(e.item.type)?e._e():i("el-autocomplete",{attrs:{"fetch-suggestions":e.queryUser,placeholder:"输入选择即可添加关联用户","trigger-on-focus":!1},on:{select:e.handleSelectUser},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.item;return[i("div",{staticClass:"name text-overflow-ellipsis",attrs:{title:s.name+"，"+s.department_name}},[e._v(e._s(s.name+"，"+s.department_name))])]}}]),model:{value:e.stateUser,callback:function(t){e.stateUser=t},expression:"stateUser"}})],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!!this.item.department_id||e.isBuiltInRole(e.item.type),expression:"!!this.item.department_id || isBuiltInRole(item.type)"}],staticClass:"dialog-table"},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.item.associated_user,size:"mini"}},[i("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),e._v(" "),i("el-table-column",{attrs:{prop:"employee_code",label:"工号"}}),e._v(" "),i("el-table-column",{attrs:{prop:"name",label:"用户名"}}),e._v(" "),e.isEdit&&e.isSectionRole(e.item.type)?e._e():i("el-table-column",{attrs:{label:"操作",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(i){e.handleDelUser(t.$index)}}},[e._v("删除")])]}}])})],1)],1)])],1),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.kyeDialog.hasDialog=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("保存")])],1)]),e._v(" "),i("role-detail",{attrs:{item:e.item,"role-types":e.roleTypes,"has-detail":e.hasDetail},on:{"is-show-dialog":function(t){e.hasDetail=!1}}})],1)},staticRenderFns:[]};var u=i("vSla")(m,c,!1,function(e){i("eOib")},"data-v-09f3a9de",null);t.default=u.exports},w85B:function(e,t,i){"use strict";var s=i("TtmE"),a=i("45w3"),n={components:{KyeDialog:s.a,SystemItem:a.a},data:function(){return{}},props:{item:{type:Object,required:!0},hasDetail:{type:Boolean,required:!0},roleTypes:{type:Object,required:!0},title:{type:String,default:"角色详情"}},methods:{isShowDialog:function(){this.$emit("is-show-dialog",!1)}}},l={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("kye-dialog",{attrs:{hasDialog:e.hasDetail,title:e.title},on:{"is-show-dialog":e.isShowDialog}},[i("div",{attrs:{slot:"body"},slot:"body"},[i("div",{staticClass:"detail-filters"},[i("el-row",[i("el-col",{attrs:{span:8}},[i("div",[e._v("角色名称"),i("span",[e._v(e._s(e.item.name))])])]),e._v(" "),i("el-col",{attrs:{span:8}},[i("div",[e._v("角色类型"),i("span",[e._v(e._s(e.roleTypes[e.item.type]))])])]),e._v(" "),i("el-col",{attrs:{span:8}},[i("div",[e._v("角色状态"),i("span",[e._v(e._s("1"==e.item.status?"已启用":"已禁用"))])])])],1),e._v(" "),i("el-row",[i("el-col",{attrs:{span:8}},[i("div",[e._v("所属部门"),i("span",[e._v(e._s(e.item.department_name))])])])],1)],1),e._v(" "),i("div",{staticClass:"li-item"},[i("i"),i("span",{staticClass:"li-item-title"},[e._v("关联系统")])]),e._v(" "),i("div",{staticClass:"system-items"},e._l(e.item.associated_system,function(e,t){return i("system-item",{key:t,attrs:{item:e}})})),e._v(" "),i("div",{staticClass:"li-item"},[i("i"),i("span",{staticClass:"li-item-title"},[e._v("关联用户")])]),e._v(" "),i("div",{staticClass:"dialog-table"},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.item.associated_user,size:"mini"}},[i("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),e._v(" "),i("el-table-column",{attrs:{prop:"employee_code",label:"工号"}}),e._v(" "),i("el-table-column",{attrs:{prop:"name",label:"用户名"}}),e._v(" "),i("el-table-column",{attrs:{prop:"department_name",label:"所属部门"}})],1)],1)]),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.isShowDialog}},[e._v("确定")])],1)])},staticRenderFns:[]};var o=i("vSla")(n,l,!1,function(e){i("Swgr")},"data-v-67a80b84",null);t.a=o.exports}});
//# sourceMappingURL=4.d7fbb5feba4b8dca2266.js.map