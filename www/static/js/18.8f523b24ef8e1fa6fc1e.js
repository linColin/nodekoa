webpackJsonp([18],{V8uD:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("4YfN"),r=s.n(a),l=s("gyMJ"),i=s("Cz8s"),o=s("TtmE"),n={components:{TopHeader:i.a,KyeDialog:o.a},data:function(){return{value:void 0,sysSearch:{name:void 0,access_type:void 0,status:void 0},sysData:[],sysStatus:[{id:1,name:"已启用"},{id:2,name:"已禁用"}],accessType:[{id:1,name:"CAS"},{id:2,name:"LDAP"}],page:{current:1,sizes:[10,20,50,100],size:10,total:0},kyeDialog:{hasDialog:!1,title:"新增系统"},stateUser:void 0,ruleForm:{id:void 0,user_id:void 0,name:void 0,status:void 0,access_type:void 0,type:void 0,url:void 0,remark:void 0,icon:void 0,ip_address:void 0,default_login:void 0},loginOptiondisabled1:!1,loginOptiondisabled2:!1,formStatus:[{id:1,name:"启用"},{id:2,name:"禁用"}],formType:[{id:1,name:"基本系统"},{id:2,name:"业务系统"}],itemsIcon:[{id:1,name:"邮箱",icon:"email"},{id:2,name:"网络准入",icon:"permission"},{id:3,name:"VPN",icon:"vpn"},{id:4,name:"堡垒机",icon:"bastion"},{id:5,name:"WIKI",icon:"wiki"},{id:6,name:"禅道",icon:"chandao"},{id:7,name:"安全管理平台",icon:"safe"},{id:8,name:"运维开发平台",icon:"operations"},{id:9,name:"金蝶",icon:"kingdee"},{id:10,name:"ERP",icon:"erp"},{id:11,name:"绩效管理平台",icon:"performance"},{id:12,name:"客服系统",icon:"service"},{id:13,name:"OA",icon:"oa"},{id:14,name:"电商运营后台",icon:"mall"},{id:15,name:"人力资源系统",icon:"hr"},{id:16,name:"资产管理系统",icon:"assets"}],rules:{name:[{required:!0,message:"请输入系统名称",trigger:"change"}],status:[{required:!0,message:"请选择系统状态",trigger:"change"}],user_id:[{required:!0,message:"请输入系统负责人",trigger:"change"}],access_type:[{required:!0,message:"请选择接入方式",trigger:"change"}],type:[{required:!0,message:"请选择系统类型",trigger:"change"}],url:[{required:!1,message:"请输入系统链接",trigger:"change"}],icon:[{required:!0,message:"请选择系统图标",trigger:"change"}],ip_address:[{required:!0,message:"请输入系统IP",trigger:"change"}],default_login:[{required:!0,message:"请选择登录方式",trigger:"change"}]}}},watch:{stateUser:function(e){void 0!==e&&""!==e||(this.ruleForm.user_id=void 0)},hasDetail:function(e,t){e||(this.stateUser=void 0,this.ruleForm.id=void 0,this.ruleForm.user_id=void 0,this.ruleForm.name=void 0,this.ruleForm.status=void 0,this.ruleForm.access_type=void 0,this.ruleForm.type=void 0,this.ruleForm.url=void 0,this.ruleForm.remark=void 0,this.ruleForm.icon=void 0,this.ruleForm.ip_address=void 0)}},methods:{queryUser:function(e,t){this.ruleForm.user_id=void 0,l.a.getUserList({name:e,per_page:10,page:1}).then(function(e){var s=e.result||{};t(s.data||[])})},handleSelectUser:function(e){this.stateUser=e.name,this.ruleForm.user_id=e.id},requestList:function(){var e=this,t=r()({},this.sysSearch,{page:this.page.current,per_page:this.page.size});l.a.searchSys(t).then(function(t){var s=t.result||{};e.page.total=s.pagination?s.pagination.total_count:0,e.sysData=s.data||[]})},getSysStatus:function(e){var t=this.sysStatus.find(function(t){return t.id===e});return t?t.name:""},getAccessType:function(e){var t=this.accessType.find(function(t){return t.id===e});return t?t.name:""},handleSearch:function(){this.page.current=1,this.requestList()},handleSizeChange:function(e){this.page.size=e,this.requestList()},handleCurrentChange:function(e){this.page.current=e,this.requestList()},onAdd:function(){this.kyeDialog.title="新增系统",this.resetForm("ruleForm"),this.isShowDialog("add")},isShowDialog:function(e){this.kyeDialog.hasDialog=e,e||this.resetForm("ruleForm")},accessTypeChange:function(){2===this.ruleForm.access_type?(this.ruleForm.default_login=1,this.loginOptiondisabled2=!0):this.loginOptiondisabled2=!1},loginTypeSelectChange:function(e){console.log(this.ruleForm.default_login)},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var s=r()({},t.ruleForm);s.ip_address=s.ip_address.split(/\r\n|[\r\n]/).filter(function(e){return""!==e}).join(","),"add"===t.kyeDialog.hasDialog?l.a.addSys(s).then(function(e){t.kyeDialog.hasDialog=!1,t.$message.success("保存成功"),t.requestList()}):l.a.putSys(s.id,s).then(function(e){t.kyeDialog.hasDialog=!1,t.$message.success("保存成功"),t.requestList()})})},resetForm:function(e){this.$refs[e]&&this.$refs[e].resetFields&&this.$refs[e].resetFields()},onRevise:function(e){var t=this;this.kyeDialog.title="修改系统",l.a.reviseSys(e).then(function(e){console.log(e.result);var s=e.result||{};t.ruleForm.id=s.id||void 0,t.ruleForm.user_id=s.user_id||void 0,t.ruleForm.name=s.name||void 0,t.ruleForm.status=s.status||void 0,t.ruleForm.access_type=s.access_type||void 0,t.ruleForm.type=s.type||void 0,t.ruleForm.url=s.url||void 0,t.ruleForm.default_login=s.default_login||void 0,t.ruleForm.remark=s.remark||void 0,t.ruleForm.icon=s.icon||void 0,t.stateUser=s.user_name||void 0,t.ruleForm.ip_address=s.ip_address?s.ip_address.replace(/,/g,"\n"):void 0,t.kyeDialog.hasDialog="edit"})}},beforeMount:function(){this.requestList()}},u={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"sysManage"},[s("top-header",{attrs:{title:"系统管理"}},[s("div",{staticClass:"el-icon-plus addSystemBtn",on:{click:e.onAdd}},[e._v(" 新增系统")])]),e._v(" "),s("div",{staticClass:"page-container"},[s("div",{staticClass:"table-filters"},[s("div",{staticClass:"filter-item"},[s("p",{staticClass:"item"},[e._v("系统名称")]),e._v(" "),s("el-input",{attrs:{placeholder:"请输入",size:"small",clearable:""},model:{value:e.sysSearch.name,callback:function(t){e.$set(e.sysSearch,"name",t)},expression:"sysSearch.name"}})],1),e._v(" "),s("div",{staticClass:"filter-item"},[s("p",{staticClass:"item"},[e._v("接入方式")]),e._v(" "),s("el-select",{attrs:{size:"small"},model:{value:e.sysSearch.access_type,callback:function(t){e.$set(e.sysSearch,"access_type",t)},expression:"sysSearch.access_type"}},[s("el-option",{attrs:{label:"不限",value:void 0}}),e._v(" "),e._l(e.accessType,function(e){return s("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})],2)],1),e._v(" "),s("div",{staticClass:"filter-item"},[s("p",{staticClass:"item"},[e._v("系统状态")]),e._v(" "),s("el-select",{attrs:{size:"small"},model:{value:e.sysSearch.status,callback:function(t){e.$set(e.sysSearch,"status",t)},expression:"sysSearch.status"}},[s("el-option",{attrs:{label:"不限",value:void 0}}),e._v(" "),e._l(e.sysStatus,function(e){return s("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})],2)],1),e._v(" "),s("div",{staticClass:"search-btn"},[s("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("查询")])],1)]),e._v(" "),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.sysData,size:"mini"}},[s("el-table-column",{attrs:{type:"index",label:"序号",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s((e.page.current-1)*e.page.size+t.$index+1)+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"name",label:"系统名称"}}),e._v(" "),s("el-table-column",{attrs:{label:"系统状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{style:{color:"1"===t.row.status?"#e96767":"#00c353"}},[e._v(e._s(e.getSysStatus(t.row.status)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"接入方式"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e.getAccessType(t.row.access_type))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"bind_user_num",label:"用户数量"}}),e._v(" "),s("el-table-column",{attrs:{prop:"user_name",label:"系统负责人"}}),e._v(" "),s("el-table-column",{attrs:{prop:"remark",label:"备注"}}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(s){e.onRevise(t.row.id)}}},[e._v("修改")])]}}])})],1),e._v(" "),s("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.page.total>e.page.size,expression:"page.total > page.size"}],attrs:{background:"","page-sizes":e.page.sizes,layout:"sizes,prev,pager,next","current-page":e.page.current,total:e.page.total,"prev-text":"上一页","next-text":"下一页"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.$set(e.page,"current",t)}}})],1),e._v(" "),s("kye-dialog",{attrs:{width:"448px",hasDialog:!!e.kyeDialog.hasDialog,title:e.kyeDialog.title},on:{"is-show-dialog":e.isShowDialog,reset:function(t){e.resetForm("ruleForm")}}},[s("div",{staticClass:"dialog-body",attrs:{slot:"body"},slot:"body"},[s("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-position":"top","label-width":"80px"}},[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{size:"small",label:"系统名称",prop:"name"}},[s("el-input",{attrs:{placeholder:"请输入系统名称"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{size:"small",label:"系统状态",prop:"status"}},[s("el-select",{attrs:{placeholder:"请选择系统状态"},model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},e._l(e.formStatus,function(e){return s("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})}))],1)],1)],1),e._v(" "),s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{size:"small",label:"系统负责人",prop:"user_id"}},[s("el-autocomplete",{ref:"inputRef",staticClass:"w100",attrs:{clearable:"","fetch-suggestions":e.queryUser,placeholder:"请输入系统负责人","trigger-on-focus":!1},on:{select:e.handleSelectUser},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.item;return[s("div",{staticClass:"name text-overflow-ellipsis",attrs:{title:a.name+"，"+a.department_name}},[e._v(e._s(a.name+"，"+a.department_name))])]}}]),model:{value:e.stateUser,callback:function(t){e.stateUser=t},expression:"stateUser"}},[s("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})])],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{size:"small",label:"接入方式",prop:"access_type"}},[s("el-select",{attrs:{placeholder:"请选择接入方式"},on:{change:e.accessTypeChange},model:{value:e.ruleForm.access_type,callback:function(t){e.$set(e.ruleForm,"access_type",t)},expression:"ruleForm.access_type"}},e._l(e.accessType,function(e){return s("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})}))],1)],1)],1),e._v(" "),s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{size:"small",label:"系统类别",prop:"type"}},[s("el-select",{attrs:{placeholder:"请选择系统类别"},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},e._l(e.formType,function(e){return s("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})}))],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{size:"small",label:"系统URL",prop:"url"}},[s("el-input",{attrs:{placeholder:"请输入系统URL"},model:{value:e.ruleForm.url,callback:function(t){e.$set(e.ruleForm,"url",t)},expression:"ruleForm.url"}})],1)],1)],1),e._v(" "),s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:24}},[s("el-form-item",{staticClass:"login-type-group",attrs:{size:"small",label:"默认登录方式"}},[s("el-select",{attrs:{placeholder:"请选择登录方式",clearable:!0},model:{value:e.ruleForm.default_login,callback:function(t){e.$set(e.ruleForm,"default_login",t)},expression:"ruleForm.default_login"}},[s("el-option",{attrs:{value:1,label:"账号密码登录",disabled:e.loginOptiondisabled1}}),e._v(" "),s("el-option",{attrs:{value:2,label:"手机验证码登录",disabled:e.loginOptiondisabled2}}),e._v(" "),s("el-option",{attrs:{value:3,label:"账号密码登录或手机验证码登录",disabled:e.loginOptiondisabled2}}),e._v(" "),s("el-option",{attrs:{value:4,label:"账号密码登录和手机验证码登录",disabled:e.loginOptiondisabled2}})],1)],1)],1)],1),e._v(" "),s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:24}},[s("el-form-item",{attrs:{size:"small",label:"系统备注",name:"remark"}},[s("el-input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:3},placeholder:"请输入系统备注"},model:{value:e.ruleForm.remark,callback:function(t){e.$set(e.ruleForm,"remark",t)},expression:"ruleForm.remark"}})],1)],1)],1),e._v(" "),s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{size:"small",label:"系统图标",prop:"icon"}},[s("el-select",{attrs:{placeholder:"请选择系统图标"},model:{value:e.ruleForm.icon,callback:function(t){e.$set(e.ruleForm,"icon",t)},expression:"ruleForm.icon"}},e._l(e.itemsIcon,function(e){return s("el-option",{key:e.id,attrs:{value:e.icon,label:e.name}})}))],1)],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("div",{staticClass:"sys-icon"},[s("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[s("use",{attrs:{"xlink:href":"#icon-"+(e.ruleForm.icon||"default-img")}})])])])],1),e._v(" "),s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:24}},[s("el-form-item",{attrs:{size:"small",label:"系统IP",prop:"ip_address"}},[s("el-input",{attrs:{type:"textarea",rows:6,placeholder:"输入系统调用认证服务器所使用的IP地址，每个IP地址占一行。"},model:{value:e.ruleForm.ip_address,callback:function(t){e.$set(e.ruleForm,"ip_address",t)},expression:"ruleForm.ip_address"}})],1)],1)],1)],1)],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"small"},on:{click:function(t){e.kyeDialog.hasDialog=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("保存")])],1)])],1)},staticRenderFns:[]};var c=s("vSla")(n,u,!1,function(e){s("iR7j")},"data-v-1b65668c",null);t.default=c.exports},iR7j:function(e,t){}});
//# sourceMappingURL=18.8f523b24ef8e1fa6fc1e.js.map